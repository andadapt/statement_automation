{% extends "base.html" %}

{% block content %}
  <div class="container mt-4">
    <div class="row">
      <div class="col-12">
        <h2 class="text-primary">Report for {{ report.product.name }}</h2>
      </div>
    </div>

    <!-- Statement Compliance Banner -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="alert {% if report.statement_compliance %}alert-success{% else %}alert-warning{% endif %} text-center">
          <strong>Statement Compliance:</strong> 
          {% if report.statement_compliance %}
            <span class="font-weight-bold">Compliant</span>
          {% else %}
            <span class="font-weight-bold">Non-Compliant</span>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Report Details -->
    <div class="row">
      <div class="col-md-6">
        <ul class="list-group">
          <li class="list-group-item"><strong>Portfolio:</strong> {{ report.portfolio.name }}</li>
          <li class="list-group-item"><strong>Prepared By Date:</strong> {{ report.prepared_by_date }}</li>
          <li class="list-group-item"><strong>Last Reviewed Date:</strong> {{ report.last_reviewed_date }}</li>
          <li class="list-group-item"><strong>Last Tested Date:</strong> {{ report.last_tested_date }}</li>
          <li class="list-group-item"><strong>Days Since Last Tested:</strong> {{ report.days_since_last_tested }}</li>
          <li class="list-group-item"><strong>Tested By:</strong> {{ report.tested_by }}</li>
        </ul>
      </div>
      
      <div class="col-md-6">
        <ul class="list-group">
          <li class="list-group-item"><strong>Compliance Status:</strong> {{ report.compliance_status }}</li>
          <li class="list-group-item"><strong>WCAG:</strong> {{ report.wcag }}</li>
          <li class="list-group-item"><strong>Feedback Header:</strong> {{ report.feedback_header }}</li>
          <li class="list-group-item"><strong>Reporting Problems:</strong> {{ report.reporting_problems }}</li>
          <li class="list-group-item"><strong>Enforcement Procedure:</strong> {{ report.enforcement_procedure }}</li>
          <li class="list-group-item"><strong>Legal Compliance:</strong> {{ report.legal_compliance }}</li>
        </ul>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-12">
        <h4 class="mt-3">Contact Information</h4>
        <ul class="list-group">
          <li class="list-group-item"><strong>Feedback Email:</strong> {{ report.feedback_contact_email }}</li>
          <li class="list-group-item"><strong>Feedback Phone:</strong> {{ report.feedback_contact_phone }}</li>
          <li class="list-group-item"><strong>Problems Email:</strong> {{ report.reporting_problems_contact_email }}</li>
          <li class="list-group-item"><strong>Problems Phone:</strong> {{ report.reporting_problems_contact_phone }}</li>
        </ul>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-12">
        <h4 class="mt-3">Non-Accessible Content</h4>
        <p>{{ report.non_accessible_content }}</p>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-12">
        <h4 class="mt-3">Report Metadata</h4>
        <ul class="list-group">
          <li class="list-group-item"><strong>Date Report Ran:</strong> {{ report.date_report_ran }}</li>
        </ul>
      </div>
    </div>

    <!-- History Section -->
    <div class="row mt-5">
      <div class="col-12">
        <h4>History</h4>
        <table class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>Date</th>
              <th>User</th>
              <th>Change Type</th>
            </tr>
          </thead>
          <tbody>
            {% for record in history %}
              <tr>
                <td>{{ record.history_date }}</td>
                <td>{{ record.history_user }}</td>
                <td>{{ record.get_history_type_display }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="3">No history found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-12">
        <a class="btn btn-primary" href="{% url 'compliance:report_list' %}">‚Üê Back to Reports</a>
      </div>
    </div>
  </div>
{% endblock %}
